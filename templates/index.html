<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Reforma Tributária</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">Simulador Reforma Tributária 2026–2033</h2>
    <form method="POST" class="row g-3">
        <div class="col-md-3">
            <label class="form-label">Valor da Nota</label>
            <input type="number" step="0.01" class="form-control" name="valor" required>
        </div>
        <div class="col-md-3">
            <label class="form-label">Estado de Origem (UF)</label>
            <select class="form-select" id="uf-input" name="uf" required>
                <option value="">Selecione</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Tipo</label>
            <select name="tipo" id="tipo-select" class="form-select" required onchange="atualizarCampoUF()">
                <option value="produto">Produto</option>
                <option value="servico">Serviço</option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Simular</button>
        </div>
    </form>

    {% if resultados %}
<hr class="my-4">
<h4>Resultados</h4>
<div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Ano</th>
                <th>IBS</th>
                <th>CBS</th>
                <th>{% if 'ICMS' in resultados[0] %}ICMS{% else %}ISS{% endif %}</th>
                <th>PIS/COFINS</th>
                <th>Preço sem impostos</th>
                {% if 'DIFAL' in resultados[0] %}
                    <th>DIFAL</th>
                {% endif %}
                <th>CUSTO NESA</th>
            </tr>
        </thead>
        <tbody>
            {% for resultado in resultados %}
            <tr>
                <td>{{ resultado.ano }}</td>
                <td>R$ {{ '%.2f'|format(resultado['IBS']) }}</td>
                <td>R$ {{ '%.2f'|format(resultado['CBS']) }}</td>
                <td>
                    R$ {{ '%.2f'|format(
                        resultado.get('ICMS', resultado.get('ISS', 0.0))
                    ) }}
                </td>
                <td>R$ {{ '%.2f'|format(resultado['PIS_COFINS']) }}</td>
                <td>R$ {{ '%.2f'|format(resultado['Preço sem impostos']) }}</td>
                {% if 'DIFAL' in resultado %}
                    <td>R$ {{ '%.2f'|format(resultado['DIFAL']) }}</td>
                {% endif %}
                <td><strong>R$ {{ '%.2f'|format(resultado['CUSTO NESA']) }}</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

</div>

<script>
function atualizarCampoUF() {
    const tipo = document.getElementById('tipo-select').value;
    const ufInput = document.getElementById('uf-input');
    if (tipo === 'servico') {
        ufInput.disabled = true;
        ufInput.value = '';
    } else {
        ufInput.disabled = false;
    }
}
window.onload = atualizarCampoUF;
</script>

</body>
</html>
